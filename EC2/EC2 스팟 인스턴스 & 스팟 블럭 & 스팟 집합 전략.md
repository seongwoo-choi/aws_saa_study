# EC2 스팟 인스턴스.md

스팟 인스턴스를 사용하면 온디맨드 방식과 비교해서 최대 90% 할인된 가격으로 인스턴스를 사용할 수 있다.

이 스팟 인스턴스는 마치 경매장과 같다.

최고 가격 > 스팟 가격: 인스턴스 시작

최고 가격 < 스팟 가격: 인스턴스 종료

해당 스팟 인스턴스에 지불할 최고 가격을 정해놓고 인스턴스를 빌리는데 만약 다른 사람이 내가 지불한 최고 가격보다 더 많은 돈을 내면 그 사람에게 스팟 인스턴스가 제공되게 된다.

스팟 인스턴스는 주문과 용량에 따라 가격이 변동하기 때문에 가격이 오르락 내리락한다.

만약 내가 스팟 인스턴스에 지불할 최대 현금가 이상을 다른 사용자가 지불하면 인스턴스 중지까지 2분의 유예 시간이 주어진다.

만약 더 이상 스팟 인스턴스를 사용하지 않겠다면 수행 중인 모든 작업을 종료한 다음 인스턴스를 중지하고 어느날 다시 요금이 내려가면 인스턴스를 다시 구매해서 시작하고 중단한 부분부터 시작할 수 있다.

아니면, EC2 인스턴스가 더 이상 필요하지 않을 경우엔 인스턴스를 종료하고 그대로 두면 된다.

그러면 다음 작업을 다시 시작할 때 새로운 EC2 인스턴스로 시작할 수 있다.

만약 스팟 인스턴스가 AWS 에서 회수되는 것을 원하지 않는 경우 스팟 블럭이라는 전략을 사용할 수 있다.

스팟 블럭은 지정된 시간(1~6시간) 동안 스팟 인스턴스를 사용할 수 있게 하는 방법이다. 

이 시간 동안은 다른 누군가가 최고 가격으로 스팟 인스턴스를 대여해도 스팟 블럭에 의해 차단되어 스팟 인스턴스를 사용할 수 있다.

스팟 인스턴스는 언제 다른 사용자에게 뺐길지 모르기 때문에 중요한 작업이나, 데이터베이스 작업에는 적합하지 않다는 것을 알면 된다.

US-East-1 region 에서 6개의 가용 영역에서 스팟 인스턴스에 대한 가격을 확인할 수 있다. 

최고 가격은 사용중인 AZ 에 따라 다르고 어떤 AZ 에서는 가격의 변동이 큰 것을 확인할 수 있다.

실선의 가격이 점선보다 아래로 내려가게 되면 스팟 인스턴스를 잃게 된다. 

![image](https://user-images.githubusercontent.com/67403886/156385206-8ce4fb69-cb9f-449d-a67a-1b45fe6d5683.png)

스팟 인스턴스를 종료하기 위해서는 스팟 요청이 작동하는 방식을 이해해야 한다.

스팟 사용을 요청하면 원하는 인스턴스의 수, 지불할 최고 가격, 사양, AMI 등을 정의할 수 있다.

그리고 언제까지 사용할지도 정할 수 있다.

스팟 인스턴스에 대해 일회성 요청 또는 지속적인 요청을 수행할 수 있다.

일회성 요청일 경우에는 스팟 요청이 완료되는 즉시 인스턴스가 실행된다. 그러고나서는 두 번 다시 스팟 요청을 할 수 없다. 

why? 일회성 요청이었기 떄문에..

![image](https://user-images.githubusercontent.com/67403886/156386070-447e0f13-9d20-4a2b-bfe6-59ec95f7ef85.png)

만약 지속적 요청인 경우 스팟 요청이 최고 가격에 따라 인스턴스가 중지되거나 중단 되면 스팟 요청이 재실행 된다.

그리고 해당하는 스팟 요청에 따라 스팟 인스턴스가 재실행 된다.

만약 지속적 요청인 경우에 스팟 인스턴스가 중되되면 스팟 요청을 자동적으로 수행하여 인스턴스를 실행시킬 수 있다.

![image](https://user-images.githubusercontent.com/67403886/156387104-3daf96d1-92c0-4eab-8b66-b74b7ee05a6a.png)

만약 스팟 인스턴스를 취소하기를 원한다면 일단 스팟 요청을 취소해야 한다.

그리고 실행 중인 스팟 인스턴스를 종료해야 한다.

만약 스팟 인스턴스를 먼저 종료하면 스팟 요청으로 되돌아가서 스팟 요청에 대한 명세서를 작성하게 된다.

시험에 나올 수 있는 부분이므로 알아두면 좋다.

스팟 집합은 스팟 인스턴스의 모음으로 스팟 인스턴스가 가격 또는 용량의 변경으로 중단될 경우 목표 용량 집합을 유지하려고 시도한다.

스팟 집합 전략(Spot Fleets)

lowestPrice (최저가격, 시험에 제일 많이 나온다)
- 최저 가격의 풀에서 스팟 인스턴스를 가져옴
- 기본 전략으로 최저가로 입찰 가능

Diversified (다각화)
- 모든 풀에 분산해서 스팟 인스턴스를 가져옴
- 가용성 및 하나의 풀에서 발생하는 가격상승에 덜 민감해짐
- 온디맨드 가격보다 높은 가격의 풀에서는 시작하지 않음

스팟 플릿을 사용하면 다얀란 폴, 다양한 인스턴스 유형을 정의해서 가져올 수 있다는 점이다.

스팟 집합을 위해 최저 가격 전략을 사용하면 스팟 집합은 자동적으로 최저가로 스팟 인스턴스를 요청하기 때문에 요금 절약을 할 수 있게 해준다.

즉, 원하는 인스턴스 유형과 원하는 AZ 를 정확히 알고 스팟 집합 전략을 사용하면 매우 효과적이다!


