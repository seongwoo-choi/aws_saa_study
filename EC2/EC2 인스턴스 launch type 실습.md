# EC2 인스턴스 launch type 실습

EC2 서비스에 들어와서 왼쪽 편에서 스팟 요청을 찾아서 클릭한다.

![image](https://user-images.githubusercontent.com/67403886/156394462-916aeb73-7c3c-43f5-80c0-69d177ee8bd2.png)

요금 내역을 클릭하면 스팟 인스턴스의 가격 내역을 확인할 수 있다.

c5.large 인스턴스 유형을 Linux 를 사용하며 3개월 범위를 줄 경우 아래처럼 그래프로 시간에 따라 가격이 변동되고 있는 것을 확인할 수 있다.

그래프 위에 존재하는 검정 선은 온디맨드 가격대이다.

가격이 굉장히 저렴한 것을 확인할 수 있다. 대략 67 프로 정도 절감하여 인스턴스를 사용할 수 있다.

![image](https://user-images.githubusercontent.com/67403886/156394784-cb52cd01-d5c0-4ce7-baae-59fa39e4fc96.png)

스팟 인스턴스를 어떻게 구할 수 있을까??

스팟 인스턴스 요청을 클릭하면 시작 파라미터를 수동으로 구성하거나 시작 템플릿을 사용해서 파라미터를 구성할 수 있다.

AMI, 키페어, EBS 세팅, 모니터링, 네트워크, 인스턴스 유형 요구 사항 등..거의 모든 변수들을 세팅할 수 있다.

![image](https://user-images.githubusercontent.com/67403886/156395392-d2bd032d-8ffe-4453-aa69-5a2b19e327f1.png)

### 추가 요청 세부를 확인하자

기본값 적용에 체크가 되어있을텐데 체크를 눌러 해제한다.

그럼 아래 그림과 같이 세부 정보를 구성할 수 있게 된다.

최대 가격을 정할 수 있고 요청 유효 시작 기간이나 요청 유효 종료 시간, 요청 만료 시 인스턴스를 종료할 것인지 아닌지에 대한 설정 

그리고 이 스팟 인스턴스를 하나 이상의 클래식 로드 밸런스 또는 대상 그룹에 연결할 수 있다.

세부 사항을 설정하지 않을 것이면 기본값을 적용한다.

![image](https://user-images.githubusercontent.com/67403886/156395852-3122201c-4c54-4df3-a2dd-a7d90a02270b.png)

### 다음으로는 목표 용량 설정이다.

실행할 총 목표 용량(인스턴스 또는 vCPU 수 또는 메모리)를 설정할 수 있다.

만약 시작 템플릿을 지정한 경우라면 목표 용량의 일부를 온디맨드 방식으로 할당할 수 있다. 

온디맨드 인스턴스 수는 항상 유지되지만 스팟 인스턴스는 확장할 수 있다.

만약 스팟 인스턴스가 종료 or 중지 or 수면 상태가 된 경우 스팟 인스턴스의 용량을 재조정하거나 스팟 인스턴스 플릿(집합) 내 모든 스팟 인스턴스에 대해 지불하고자 하는 시간당 최대 금액을 설정할 수 있다. 

![image](https://user-images.githubusercontent.com/67403886/156397699-f439b1eb-eb0b-4526-876f-765007843dc2.png)

### 다음으로는 네트워크 세팅이다.

해당 스팟 인스턴스를 어떤 AZ 에서 실행할지 특정 VPC 로 시작할지 등에 대한 설정을 할 수 있다.

![image](https://user-images.githubusercontent.com/67403886/156398048-2561a5b9-dcf4-4d82-af72-8be915d9ed18.png)

### 다음으로는 인스턴스 유형 세팅이다.

스팟 집합 요청에 대해 특정 기준에 따른 EC2 인스턴스를 수동을 선택할 수 있다. c3.large 나 c4.large 같은 유형들..

![image](https://user-images.githubusercontent.com/67403886/156398367-717c3d03-9525-4da3-9c7e-49aad0eb6a93.png)

또는 인스턴스 당 vCPU 및 메모리 같은 컴퓨팅 요구 사항을 직접 입력해서 인스턴스 속성을 세팅할 수 있다. 

입력한 속성들을 보고 알맞은 인스턴스 유형을 매칭해준다.

![image](https://user-images.githubusercontent.com/67403886/156398566-5f52602e-c2a0-4b86-aeab-e8212e259d2d.png)

### 다음으로는 할당 방식이다.

용량 최적화를 AWS 에서는 권장하며 사용 가능한 스팟 용량과 시작 중인 인스턴스 수를 기준으로 스팟 인스턴스를 최적화하여 시작한다.

최저 가격 방식은 가장 저렴한 가격으로 스팟 인스턴스를 구매하고 싶을 때 사용하는 전략이다. 요금을 크게 절약할 수 있다.

인스턴스 유형 요구 사항에서 인스턴스 유형을 직접 선택했다면 3번째 할당 방식이 활성화 된다.

이 방식은 플릿(집합) 내에 있는 EC2 인스턴스 유형들에 대한 최저 요금 조합을 선정해주는 방식이다.

![image](https://user-images.githubusercontent.com/67403886/156399099-d980ec26-3bb2-42ca-b943-a16fc77c9e74.png)

마지막으로는 집합 요청에 대한 요약이 나온다.

해당 인스턴스 집합이 강력한 집합인지, 어떤 AZ 에서 일치하는 인스턴스의 수가 몇개인지 등을 알려준다.

그런 다음 이 집합에 대해 예상되는 시간당 가격을 알려준다.

여기서는 시간당 0.030 달러로 온디맨드 방식과 비교했을 때 76% 절약된 가격인 것을 알 수 있다.

![image](https://user-images.githubusercontent.com/67403886/156399747-ad1fb222-8cfa-4501-807f-7e6fd837c8a2.png)

이 스팟 인스턴스가 어떻게 작동하는지 정확히 알 필요는 없다.

하지만 스팟 집합 요청에서 모든 파라미터들을 잘 설정해줘야 한다.

## 한 개의 스팟 인스턴스를 실행하고 싶은 경우

온디맨드 인스턴스를 생성하는 것과 동일하지만 아래 사진처럼 구매 옵션에서 스팟 인스턴스 요청을 클릭해서 활성화 해야 한다.

최고 가격을 0.0045 로 설정하고 스팟 인스턴스의 가격이 0.0045 보다 적게 유지되면 최고 가격을 잘 설정한 것이다.

연속 요청을 체크 표시하여 활성화한다.

이건 내 스팟 인스턴스가 종료되면 어떻게 할지 설정하는 부분이다. 

스팟 인스턴스를 종료하는 대신 중지할 수 있고 Hibernate 즉, 절전 모드로 전환할 수 있는데 t2.micro 는 절전 모드를 지원하지 않는다.

![image](https://user-images.githubusercontent.com/67403886/156401755-3255fcab-389e-4761-84b5-8a3582a19872.png)


# 예약 인스턴스 (Reserved Instance)

인스턴스 서비스에서 예약 인스턴스를 클릭한다.

예약 인스턴스는 특정 유형의 인스턴스를 구입할 수 있도록 한다.

![image](https://user-images.githubusercontent.com/67403886/156401891-514d8db6-d315-4f1f-a3ca-3b07b8d8ff66.png)

만약 Linux 를 사용하는 c5.large 인스턴스 유형을 예약 하고 싶으면 해당 조건으로 검색을 하면 된다.

그럼 아래처럼 예약 능한 모든 목록들이 나온다.

![image](https://user-images.githubusercontent.com/67403886/156402406-899e9254-e9fc-4d82-8684-5c0fe5315c0f.png)

원하는 수량(인스턴스 갯수)을 장바구니에 추가한 후에 장바구니 보기를 클릭한다. (여러개를 구매할 수 있다.)

해당하는 인스턴스에 대한 자세한 설명이 있고 선결제를 해서 사용하는 방식이다.

가격이 비싸기 때문에 예약 인스턴스는 사용하지 않는 걸 추천하고 Saving Plans 를 사용하자.

![image](https://user-images.githubusercontent.com/67403886/156402832-984a14a1-a57a-4ea2-8d97-025e555ef812.png)

### Saving Plans

왼쪽 편에서 Saving Plans 를 찾을 수 있다.

시간당 금액을 내는 서비스로, 1년 또는 3년 동안 시간당 사용 비용을 약정하여 EC2, Lambda 및 Fargate 사용량에 대해 저렴한 가격을 제공하는 할인 모델이다. 

($/시간 단위로 약정 가능) Savings Plans를 구매하면 사용에 대한 할인된 Savings Plans 가격이 약정 만료 시까지 청구된다. 

예를 들어 한 시간에 $10의 컴퓨팅 사용량을 약정하면 컴퓨팅 사용량에 대해 $10까지 Savings Plans 가격이 청구되고 약정 이외의 사용량은 온디맨드 요금이 청구된다.

![image](https://user-images.githubusercontent.com/67403886/156403295-f2998bd3-e687-41e3-9b8f-f6c24e6e122d.png)

Saving Plans 는 두가지 유형으로 제공된다.

1) 컴퓨팅 비용 절감 계획 (Compute Savings Plans)
- 최대 66% 절감
- 최대의 유연성을 제공
  - EC2 인스턴스 패밀리, 인스턴스 사이즈, AZ, 리전, OS, tenancy 관계 없이 적용
  - Fargate 적용
  - 예) c4에서 m5 인스턴스 변경하거나, EU(Ireland)에서 EU(London)으로 이동하거나, EC2에서 Fargate로 이동해도 자동으로 할인 적용
- 기존 컨버터블 RI와 할인율 동일
2) EC2 인스턴스 절약 계획 (EC2 Instance Savings Plans)
- 최대 72% 절감
- RI 대비 향상된 유연성 제공
  - AZ, 인스턴스 사이즈, OS, Tenancy 관계 없이 적용
  - 리전, 인스턴스 패밀리는 지정
  - 예) Windows를 실행하는 c5.xlarge를 Linux를 실행하는 c5.2xlarge로 이동해도 자동으로 할인 적용
- 기존 표준 RI와 할인율 동일

### 전용 호스트

기존 소프트웨어 라이선스를 지원하고 규정 준수를 개선하는 전용 하드웨어이다.

Amazon EC2 전용 호스트를 사용하면 Amazon EC2에서 Microsoft 및 Oracle 같은 공급업체의 적격 소프트웨어 라이선스를 사용할 수 있으므로, 

고객이 자사의 보유 라이선스를 활용하는 유연성과 비용 효율성을 보장받으면서 AWS의 복원력, 간편성 및 탄력성을 활용할 수 있다. 

Amazon EC2 전용 호스트는 고객에게 전용으로 제공되는 물리적 서버로, 회사 규정 준수 요건을 해결하는 데 유용하다.

AWS에서 제공되는 라이선스로 EC2 인스턴스를 시작하듯이 전용 호스트에서 가상 머신(인스턴스)을 원활하게 시작할 수 있다.

요금이 엄청나기 때문에 사용하는 경우는 거의 없을 것이다.

![image](https://user-images.githubusercontent.com/67403886/156404308-13961c79-f0b0-4c39-9b0f-74c1a0dd6890.png)

### 용량 예약

EC2 인스턴스에서 용량 부족 오류를 방지하기 위해 사용하는 방식이다.

중요 인스턴스를 용량 예약으로 시작하면 실시간 용량 예약 사용량을 확인할 수 있고 필요에 따라 인스턴스를 시작할 수 있다.

필요할 때 언제든지 필요한 만큼 EC2 용량에 액세스할 수 있으며 유지할 수 있다. 

1년 또는 3년 기간의 약정에 가입하지 않고도 언제든지 용량 예약를 생성할 수 있으며 용량은 즉시 이용할 수 있다.

이 용량은 용량 예약이 활성 상태인 동안은 예약 상태로 유지되며 언제든지 인스턴스를 설정한 용량으로 시작할 수 있다. 

용량 예약이 열려 있으면 일치하는 속성이 있는 새 인스턴스 및 기존 인스턴스는 용량 예약의 용량으로 자동 실행된다. 

![image](https://user-images.githubusercontent.com/67403886/156404879-c443057e-69f6-45f7-9a12-ca6a05e715ee.png)
